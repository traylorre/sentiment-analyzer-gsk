# Lint Workflow
# Runs black and ruff on every push and PR
#
# For On-Call Engineers:
# - Lint failures don't affect production, but block merges
# - Fix locally with: black src/ tests/ && ruff check src/ tests/ --fix
#
# For Developers:
# - Configure editor to format on save with black
# - Ruff includes security checks (bandit rules)

name: "PR Check: Code Quality"

on:
  workflow_dispatch:  # Manual trigger from GitHub UI
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lint:
    name: Code Quality
    runs-on: ubuntu-latest

    permissions:
      contents: read

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Set up Python 3.11
        uses: actions/setup-python@v6
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install linting tools
        run: |
          python -m pip install --upgrade pip
          pip install black==23.11.0 ruff==0.1.6

      - name: Check formatting with black
        run: |
          # On-Call Note: Fix with 'black src/ tests/'
          black --check --diff src/ tests/

      - name: Check linting with ruff
        run: |
          # On-Call Note: Fix with 'ruff check src/ tests/ --fix'
          # Includes security checks (S rules from bandit)
          ruff check src/ tests/

      - name: Check for security issues
        run: |
          # Explicit security-focused check
          # On-Call Note: S rules catch common vulnerabilities
          ruff check src/ --select S --output-format=github
