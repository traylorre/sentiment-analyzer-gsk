# Pytest Configuration
# Sentiment Analyzer - Demo 1 (001-interactive-dashboard-demo)
#
# For On-Call Engineers:
# - Run tests: pytest
# - Run with coverage: pytest --cov=src --cov-report=term-missing
# - Run specific test: pytest tests/unit/test_foo.py -v
# - If tests fail in CI but pass locally, check Python version (must be 3.13)
#
# For Developers:
# - Coverage must be >80% (enforced by CI/CD)
# - Use moto for AWS mocking, responses for HTTP mocking

[pytest]
# Test discovery
minversion = 7.0
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Async support
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Output configuration
# -ra: show extra summary for all except passed
# --strict-markers: fail on unknown markers
# --tb=short: shorter tracebacks for readability
addopts =
    -ra
    --strict-markers
    --tb=short
    -v

# Markers for test categorization
# Usage: pytest -m "unit" or pytest -m "not slow"
markers =
    unit: Unit tests with mocked dependencies
    integration: Integration tests with multiple components
    e2e: End-to-end tests against real AWS preprod environment
    slow: Tests that take >5 seconds (model loading, etc.)
    smoke: Smoke tests that must pass before production deployment
    benchmark: Performance benchmark tests (not blocking)
    preprod: Preprod-only tests (requires AWS credentials)
    auth: Authentication-related tests
    cleanup: Manual cleanup utilities (run with --run-cleanup)
    manual: Tests that require manual triggering
    # User story markers for E2E test suite (008-e2e-validation-suite)
    us1: User Story 1 - Anonymous to Authenticated flow
    us2: User Story 2 - OAuth authentication flows
    us3: User Story 3 - Configuration CRUD operations
    us4: User Story 4 - Sentiment and Volatility data
    us5: User Story 5 - Alert rule lifecycle
    us6: User Story 6 - Notification delivery pipeline
    us7: User Story 7 - Rate limiting enforcement
    us8: User Story 8 - Circuit breaker behavior
    us9: User Story 9 - Ticker validation
    us10: User Story 10 - Real-time SSE updates
    us11: User Story 11 - CloudWatch observability
    us12: User Story 12 - Market status

# Warning filters
# Suppress deprecation warnings from dependencies (not our code)
filterwarnings =
    ignore::DeprecationWarning:moto.*:
    ignore::DeprecationWarning:boto.*:
    ignore::DeprecationWarning:urllib3.*:
    ignore::PendingDeprecationWarning

# Logging configuration for tests
# log_cli: Show logs in console output during test run
# log_cli_level: Only show WARNING and above in console (keeps output clean)
# log_level: Capture DEBUG and above for caplog (for assertions in tests)
log_cli = true
log_cli_level = WARNING
log_level = DEBUG
log_cli_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S
