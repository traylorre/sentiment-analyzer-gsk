# Tasks: Dynamic Dashboard Link

**Input**: Design documents from `/specs/010-dynamic-dashboard-link/`
**Prerequisites**: plan.md, spec.md, research.md, quickstart.md

**Tests**: Unit tests ARE included as mentioned in plan.md (Testing section)

**Organization**: This feature has a single user story. Tasks are organized sequentially since they touch the same files.

## Format: `[ID] [P?] [Story] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- **[US1]**: Dynamic dashboard link user story
- Include exact file paths in descriptions

---

## Phase 1: Setup

**Purpose**: Verify prerequisites and understand existing code

- [X] T001 Review existing interview dashboard structure in interview/index.html
- [X] T002 Review existing deploy workflow in .github/workflows/deploy.yml
- [X] T003 Verify S3 bucket preprod-sentiment-lambda-deployments exists and is accessible

---

## Phase 2: Foundational (CI/CD Metadata Generation)

**Purpose**: Create deployment metadata infrastructure that must exist before UI can consume it

**âš ï¸ CRITICAL**: Metadata must be generated by deploy workflow before dashboard can display it

- [X] T004 [US1] Add metadata generation step to preprod deploy job in .github/workflows/deploy.yml
- [X] T005 [US1] Add metadata generation step to prod deploy job in .github/workflows/deploy.yml
- [ ] T006 [US1] Configure S3 bucket CORS policy for GitHub Pages access (deferred - may already be configured)

**Checkpoint**: After merge and deploy, `deployment-metadata.json` should exist in S3

---

## Phase 3: User Story 1 - Dynamic Dashboard Link (Priority: P1) ðŸŽ¯ MVP

**Goal**: Add dynamic link from interview dashboard to live service with last-deployed date

**Independent Test**: Open interview/index.html, verify link appears, toggle preprod/prod, verify link URL changes and date updates

### Tests for User Story 1

> **NOTE: Tests validate HTML structure and JS function definitions**

- [X] T007 [P] [US1] Add TestDashboardLink class with test_dashboard_link_exists in tests/unit/interview/test_interview_html.py
- [X] T008 [P] [US1] Add test_last_deployed_element_exists in tests/unit/interview/test_interview_html.py
- [X] T009 [P] [US1] Add test_fetch_deployment_metadata_function in tests/unit/interview/test_interview_html.py
- [X] T010 [P] [US1] Add test_update_dashboard_link_function in tests/unit/interview/test_interview_html.py
- [X] T011 [P] [US1] Add test_metadata_url_defined in tests/unit/interview/test_interview_html.py

### Implementation for User Story 1

- [X] T012 [US1] Add METADATA_URL constant after ENVIRONMENTS in interview/index.html (around line 1503)
- [X] T013 [US1] Add deploymentMetadata cache variable in interview/index.html
- [X] T014 [US1] Add fetchDeploymentMetadata() async function in interview/index.html
- [X] T015 [US1] Add updateDashboardLink(env, metadata) function in interview/index.html
- [X] T016 [US1] Add HTML elements for link and date in header section of interview/index.html (around line 580)
- [X] T017 [US1] Modify initEnvToggle() to call updateDashboardLink on load and toggle in interview/index.html

**Checkpoint**: User Story 1 complete - link visible, updates on toggle, shows deployment date

---

## Phase 4: Polish & Validation

**Purpose**: Ensure all tests pass and feature works end-to-end

- [X] T018 Run unit tests: pytest tests/unit/interview/test_interview_html.py -v
- [ ] T019 Manual test: Open interview/index.html in browser, verify link and toggle behavior
- [X] T020 Code formatting: Verify JavaScript follows existing style in interview/index.html
- [ ] T021 Commit all changes with descriptive message

---

## Dependencies & Execution Order

### Phase Dependencies

- **Setup (Phase 1)**: No dependencies - can start immediately
- **Foundational (Phase 2)**: Depends on Setup - metadata must exist before UI consumes it
- **User Story 1 (Phase 3)**: Can start tests in parallel with Phase 2, implementation after Phase 2
- **Polish (Phase 4)**: Depends on Phase 3 completion

### Task Dependencies Within User Story 1

```
T007-T011 (tests) â†’ can run in parallel, independent of implementation
T012-T013 (constants) â†’ must come before T014-T015 (functions)
T014-T015 (functions) â†’ must come before T017 (integration)
T016 (HTML) â†’ must come before T017 (integration)
T017 (integration) â†’ depends on all T012-T016
```

### Parallel Opportunities

```bash
# Phase 2: CI/CD changes can be parallelized if separate PRs
T004 (preprod metadata) || T005 (prod metadata)

# Phase 3: All tests can run in parallel
T007 || T008 || T009 || T010 || T011

# Phase 3: Constants and HTML can be done in parallel
T012+T013 || T016
```

---

## Implementation Strategy

### MVP First

1. Complete Phase 1: Setup (understand existing code)
2. Complete Phase 2: Foundational (deploy workflow generates metadata)
3. Complete Phase 3: User Story 1 (dashboard shows link and date)
4. **VALIDATE**: Run tests, manual verification
5. Create PR and merge

### Suggested Order

Since all tasks modify only 3 files, execute in this order:

1. **First**: T012-T015 (JavaScript functions in interview/index.html)
2. **Second**: T016 (HTML elements in interview/index.html)
3. **Third**: T017 (Integration in initEnvToggle)
4. **Fourth**: T007-T011 (Tests in test_interview_html.py)
5. **Fifth**: T004-T006 (Deploy workflow changes)
6. **Final**: T018-T021 (Validation)

---

## Notes

- All JavaScript additions go in the existing `<script>` block in interview/index.html
- HTML elements go in the header section near the existing env-toggle
- Tests extend existing test_interview_html.py with new test class
- CI/CD changes add steps to existing deploy jobs (preprod and prod)
- S3 CORS may already allow GitHub Pages - verify before adding policy
